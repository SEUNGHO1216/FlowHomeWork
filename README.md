# Flow Assignment
<hr>

## 과제 설명
- 파일확장자 차단 : 파일확장자에 따라 업로드 시 보안상 문제가 될 수 있는 경우가 있음

    -> 특정 확장자는 업로드 또는 특정 로직 수행을 하지 않도록 하기 위한 확장자 차단 API구현


- 실행 방법 : H2 DB를 인메모리 형태로 사용. 서버 실행시키고 'localhost:8080' 입력시 구현한 창 나옴 , 'localhost:8080/h2-console'을 통해 DB확인 가능(yml참조)


## 과제 진행 시 주로 고민한 점

1. **비동기 정보 교환 위해 커스텀확장자 추가 및 삭제 시 커스텀확장자 테이블을 전부 가져오기**
  - 커스텀확장자 추가 및 삭제 API 수행 후 매번 reload 시키는 것은 프로그램 특성상 비효율적이라고 생각이 됨(잦은 데이터 수정, 삭제가 이루어지기 때문에)
  - 따라서 새로고침을 하지 않게 비동기적으로 처리하는 ajax를 사용하여 조회, 추가, 삭제 시 매번 커스텀확장자 리스트를 반환하여 사용
  - 위와 같이 설명한 상황에서 매번 DB에서 풀스캔하여 리스트 반환하는 것은 비용적으로 문제가 될 것이라 생각(지금은 비록 데이터가 적어도, 데이터가 더 많은 DB를 가정하면 더욱 문제가 됨)
  - 자바 코드에서 List를 따로 관리하여 매번 DB를 풀스캔한 리스트를 보여주는 것이 아닌 자바 코드단의 리스트를 보여줌

2. **고정확장자, 커스텀확장자 GET 메소드에서 최초 한 번은 DB에서 정보를 가져오거나, 저장한다**
  - 고정확장자 7개를 서버 실행 시 GET방식으로 DB에 저장하고 리스트를 반환, 그러나 GET방식 사용 때마다 고정확장자가 중복되어 저장하면 안 됨
  - 서버 맨 처음에 올릴 때만 고정확장자 7개를 저장하고 flag 변수를 true에서 false로 변경해서, 추후 호출 시에는 저장 로직을 안 거치게 작성
  - 지금은 인메모리 DB여서 서버를 내리면 데이터가 삭제되어 재실행 시 문제가 없어 보이지만, 일반적인 DB를 사용했을 때는 flag 변수가 다시 true가 되어 또 한번 저장할려고 할 것임
  - fixExtension에 유니크 제약조건을 걸어서 중복된 고정확장자가 저장되지 않도록 하고 try/catch구문을 활용해 에러처리 시행
  - 커스텀확장자도 DB에 있는 확장자를 먼저 불러오고 시작하는데 매 GET방식마다 DB에서 데이터 다 가져오지 않겠다고 앞서 설정함
  - 따라서 최초에만 DB를 거쳐 조회하고 그후엔 자바 코드단에서 관리하는 리스트를 조회하도록 flag 변수를 true에서 false로 변경

3. **예외 메시지 처리**
  - 중복된 확장자 입력, 20자 이상 확장자, 200개 이상 저장된 확장자 리스트일 경우엔 예외를 던지고 프론트에서 예외를 잡아서 메시지를 나타내는 과정 필요
  - @RestControllerAdivce를 활용한 예외처리 클래스를 만들고 IllegalArgumentException, NullPointerException 에러로 처리된 에러메시지를 JSON형태로 프론트에 건내줌
  - 프론트에서는 ajax의 error 항목을 통해 response를 jqXHR(jQuery) 객체로 받는다. jqXHR에서 responseText 데이터로 에러메시지만 출력하려했으나 JSON이 그대로 문자열로 출력됨(ex. {"msg":"에러","code":"BAD_REQUEST")
  - 예외처리 클래스에서 return 형태를 단순 에러메시지만 뽑아오도록 처리하면 해결 가능(ExceptionHandling 클래스 참조)
  - ResponseEntity.status(에러숫자코드).body("예외메시지"); 를 반환해서 일일이 에러메시지만 반환하게 하는 것으로도 해결 가능!

4. **중복체크**
  - 고정확장자 테이블, 커스텀확장자 테이블 두 개에서 existsBy~ Jpa 메소드를 활용하여 중복 여부 검사
  - 중복 시 위와 같이 예외처리